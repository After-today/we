---
title: "Untitled"
author: "jessi潘"
date: "2018年3月25日"
output: 
  pdf_document: 
    number_sections: yes
    toc: yes
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##非线性最小二乘
 最小二乘问题是为了找到测量值和模型预测值之间的最小误差，该问题可以简单的表示为
 ：$$min||模型-样本||^2=\underset{x}{min\,}||e(x)||^2$$
 其中e(x)为模型和样本之间的误差
    下图的数据拟合可以很好的说明最小二乘问题的结果和效果。
 ![](C:/Users/15837/Desktop/picture/12.jpg)
 
  就非线性最小二乘而言，我们通常无法直接写出其导数形式（函数过于复杂），因此我们不再去试图直接找到全局最小值，而是退而求其次通过不停的迭代计算寻找到函数的局部最小值(LocalMinimizer)，并认为该局部最小值能够使得我们的目标函数取得最优解（最小值），这就是非线性最小二乘的通常求解思路。
  非线性最小二乘模型是使用平方误差损失，来寻找一般函数（非线性）的最优参数的估计值。设非线性系统的模型为y=f(x，θ)，常用于传感器参数设定。
  式中y是系统的输出，x是输入，θ是参数(它们可以是向量)。这里的非线性是指对参数θ的非线性模型，不包括输入输出变量随时间的变化关系。在估计参数时模型的形式f是已知的，经过N次实验取得数据(x1,y1),(x2,y2)，…,(xn，yn)。估计参数的准则(或称目标函数)选为模型的误差平方和非线性最小二乘法就是求使Q达到极小的参数估计值娈。
  由于 f的非线性，所以不能象线性最小二乘法那样用求多元函数极值的办法来得到参数估计值，而需要采用复杂的优化算法来求解。常用的算法有两类，一类是搜索算法，另一类是迭代算法。
  搜索算法的思路是:按一定的规则选择若干组参数值，分别计算它们的目标函数值并比较大小;选出使目标函数值最小的参数值，同时舍弃其他的参数值;然后按规则补充新的参数值，再与原来留下的参数值进行比较，选出使目标函数达到最小的参数值。如此继续进行，直到选不出更好的参数值为止。以不同的规则选择参数值，即可构成不同的搜索算法。常用的方法有单纯形搜索法、复合形搜索法、随机搜索法等。
  迭代算法是从参数的某一初始猜测值θ出发，然后产生一系列的参数点，如果这个参数序列收敛到使目标函数极小的参数点娈，那么对充分大的N就可用N 作为娈。迭代算法的一般步骤是:
① 给出初始猜测值θ，并置迭代步数i=1。
② 确定一个向量v作为第i步的迭代方向。
③ 用寻优的方法决定一个标量步长ρ
④ 检查停机规则是否满足，如果不满足,则将i加1再从②开始重复;如果满足，则取θ为值。
典型的迭代算法有牛顿-拉夫森法、高斯迭代算法、麦夸特算法、变尺度法等。

一个常见的非线性模型的应用就是，用无线WIFI连接设备的位置来确定WIFI热端部的位置。在这样一个问题中，设备在二维网格里的位置是已知的，他们会报告离热点的距离，但是由于信号强度的波动，报告的距离会有一些随机噪音。有一个样本数据用作实例操作
```{r}
load("C:/Users/15837/Desktop/wifi.rdata")
```

```{r}
head(wifi)#x,y是设备在网格中的位置
```

```{r}
require(ggplot2)
ggplot(wifi,aes(x=x,y=y,color=Distance))+geom_point()+scale_color_gradient2(low="blue",mid="white",high = "red",midpoint = mean(wifi$Distance))#蓝色到红色表示由近到远
```
设备i和热点之间的距离公式是：
$$d=\sqrt{(\beta_x-x_i)^2+(\beta_y-y_i)^2}$$
其中beta_x和beta_y分别代表热点的位置横坐标和纵坐标
R中计算非线性最小二乘的标准函数是nls。这里的函数和lm函数相似，系数也被清楚的指定，系数的初始值放在List中。
```{r}
wifimodl<-nls(Distance~sqrt((betaX-x)^2+(betaY-y)^2),data=wifi,start=list(betaX=50,betaY=50))
summary(wifimodl)
```
热点位置的估计为betaX=17.851,betay=52.906 
```{r}
ggplot(wifi,aes(x=x,y=y,color=Distance))+geom_point()+scale_color_gradient2(low="blue",mid="white",high = "red",midpoint = mean(wifi$Distance))+geom_point(data=as.data.frame(t(coef(wifimodl))),aes(x=betaX,y=betaY),size=5,color="green")
```
